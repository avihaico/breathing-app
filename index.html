<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BreathFlow • Zen PWA</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <!-- Background Video -->
  <div class="video-container">
    <video id="bgVideo" autoplay muted loop playsinline preload="auto">
      <source src="https://assets.mixkit.co/videos/preview/mixkit-waves-coming-to-the-beach-5016-large.mp4" type="video/mp4">
      <source src="assets/bg.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </div>
  <script>
    // Simple video initialization
    document.addEventListener('DOMContentLoaded', () => {
      const bgVideo = document.getElementById('bgVideo');
      
      // Set initial video properties
      bgVideo.playsInline = true;
      bgVideo.muted = true;
      bgVideo.preload = 'auto';
      
      // Handle autoplay with a single retry
      const playVideo = () => {
        const playPromise = bgVideo.play();
        if (playPromise !== undefined) {
          playPromise.catch(error => {
            // If autoplay fails, try again after a short delay
            if (error.name === 'NotAllowedError') {
              setTimeout(() => bgVideo.play().catch(console.error), 500);
            }
          });
        }
      };
      
      // Start video when enough data is loaded
      if (bgVideo.readyState >= 2) {
        playVideo();
      } else {
        bgVideo.addEventListener('canplay', playVideo, { once: true });
      }
    });
  </script>

  <main class="app">
    <div id="visual" class="visual" role="img" aria-label="Breathing visual">
      <div id="pulse" class="pulse"></div>
      <div id="core" class="core"></div>
    </div>

    <div class="panel">
      <div id="phase" class="phase">Ready</div>

      <div class="presets">
        <button class="preset" data-in="4" data-holdin="0" data-ex="6" data-holdex="0">Calm 4/6</button>
        <button class="preset" data-in="3" data-holdin="1" data-ex="3" data-holdex="1">Box 3/1/3/1</button>
        <button class="preset" data-in="5" data-holdin="0" data-ex="5" data-holdex="0">Coherent 5/5</button>
      </div>

      <div class="controls">
        <button id="startBtn" class="btn primary">Start</button>
        <button id="stopBtn" class="btn" disabled>Stop</button>
      </div>

      <label class="row"><input id="audioToggle" type="checkbox"> Ocean ambience (assets/ocean.mp3)</label>
      <label class="row"><input id="videoToggle" type="checkbox" checked> Show background video</label>

      <div class="note">No signup • Free • Not a medical device</div>
    </div>
  </main>

  <audio id="oceanAudio" preload="auto" src="assets/ocean.mp3"></audio>

  <script src="js/app.js"></script>
  <script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js');
}
</script>

</body>
</html>
